# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: simarcha <simarcha@student.42barcelona.    +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2024/05/28 19:09:01 by asiercara         #+#    #+#              #
#    Updated: 2024/06/06 11:56:19 by simarcha         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

NAME = minishell
MKDIR = mkdir

CC = gcc

LIBFTP = libft
PATHB = build/
PATHO = build/objs/
PATHS = src/
PATHSL = src/lexer/
PATHSP = src/parser/
PATHSB = src/builtins/
PATHSEX = src/expander/
PATHSU = src/utils/
PATHSE = src/errors/
PATHEX = src/executor/

BUILD_PATHS = $(PATHB) $(PATHO)

src = src/main.c \
      src/lexer/tokenizer.c \
      src/lexer/utils_lexer.c \
      src/lexer/utils_nodes_lexer.c \
      src/lexer/utils_nodes_aux.c \
      src/parser/parser.c \
      src/parser/redirections_parser.c \
      src/parser/utils_parser.c \
      src/parser/utils_nodes_parser.c \
      src/executor/executor.c \
      src/executor/hdoc.c \
      src/executor/run_cmds.c \
      src/executor/redirections.c \
      src/executor/utils_executor.c \
      src/utils/mini_live.c \
      src/utils/verify_quotes.c \
      src/expander/expander.c \
      src/expander/manage_quotes.c \
      src/expander/calculate_len_for_malloc.c \
      src/expander/expand_the_line.c \
      src/expander/check_before_expansion.c \
      src/expander/word_splitting.c \
      src/expander/utils_expander.c \
      src/errors/parser_errors.c \
      src/builtins/builtin_echo.c \
      src/builtins/builtin_pwd.c \
      src/builtins/builtin_env.c \
      src/builtins/builtin_exit.c \
      src/builtins/builtin_utils_nodes.c \
      src/builtins/builtin_export.c \
      src/builtins/builtin_export_helper.c \
      src/builtins/builtin_unset.c \
      src/builtins/builtin_cd.c \
      src/utils/signals.c

OBJS = $(src:src/%.c=$(PATHO)%.o)

FLAGS = -Wall -Werror -Wextra# -g -fsanitize=address

LIBFT = ./libft/libft.a

HEADER = includes/minishell.h

READLINE_DIR = ./readline-8.1
READLINE_LIB = -lreadline -lhistory -L $(READLINE_DIR)

INCLUDES = -Iincludes -I$(PATHSL) -I$(PATHSP) -I$(PATHSB) -I$(PATHSEX) -I$(PATHSU) -I$(PATHSE) -I$(PATHEX) -I$(LIBFTP) -I$(READLINE_DIR)/include

all: $(BUILD_PATHS) $(NAME)

$(PATHO)%.o: src/%.c $(HEADER)
	@echo "Compiling ${notdir $<} in $(dir $<)"
	@$(CC) -c $(FLAGS) $(INCLUDES) $< -o $@

$(NAME): $(LIBFT) $(OBJS) $(HEADER)
	@$(CC) $(FLAGS) $(OBJS) $(LIBFT) $(READLINE_LIB) -o $(NAME)
	@echo "Success"

$(LIBFT):
	@$(MAKE) -C ./libft

$(BUILD_PATHS):
	@$(MKDIR) -p $(BUILD_PATHS)

clean:
	@echo "Cleaning"
	@rm -f $(OBJS)
	@rm -f $(PATHB).tmp*
	@rmdir $(PATHO) $(PATHB)
	@make clean -C $(LIBFT)

fclean: clean
	@rm -f $(NAME)
	@make fclean -C $(LIBFT)

re: fclean all

.PHONY: all clean fclean re